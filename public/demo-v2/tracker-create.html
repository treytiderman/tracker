<!DOCTYPE html>
<html lang="en" style="color-scheme: dark;">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="tracker app">
    <title>Create Tracker</title>
    <script src="https://unpkg.com/htmx.org@2.0.0"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="./css/reset.css">
</head>

<body class="font-sans bg-zinc-800 text-zinc-200 relative">

    <nav
        class="
            sticky top-0 h-12
            font-medium text-sm sm:text-base
            text-zinc-200 bg-zinc-700
            border-b border-zinc-600
            flex items-center gap-2 p-2
            shadow-md shadow-zinc-800
        "
    >

        <!-- Tracker -->
        <div>
            <button
                type="button"
                id="nav_tracker_button"
                title="Change to another page"
                class="
                    flex items-center gap-2
                    px-3 p-1 max-w-40 md:max-w-72
                    rounded-md
                    focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                    hover:bg-zinc-600
                "
            >
                <span class="whitespace-nowrap truncate">Create Tracker</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="m6 9 6 6 6-6"/>
                </svg>
            </button>

            <!-- Menu -->
            <div
                role="menu"
                id="nav_tracker_menu"
                class="
                    hidden
                    fixed z-10 top-12 left-0 right-0 bottom-0
                    overflow-y-auto 
                    border-b-2 border-zinc-600 
                    bg-black/80
                "
            >
                <div
                    id="nav_tracker_menu_items"
                    class="
                        p-2 overflow-y-auto 
                        border-b-2 border-zinc-600 
                        bg-zinc-700
                        grid gap-2
                    "
                >
                    <a href="./tracker-all.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-zinc-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        All Trackers
                    </a>
                    <a href="./tracker-create.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-violet-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        Create Tracker
                    </a>
                    <div id="nav_tracker_menu_label" class="px-3 py-1 mt-2 text-zinc-400 text-sm border-b border-zinc-600">Trackers</div>
                    <a href="./tracker-info.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-zinc-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        Walk Dog üê©
                    </a>
                    <a href="./tracker-info.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-zinc-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        Brush Teeth ü¶∑
                    </a>
                    <a href="./tracker-info.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-zinc-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        Workout üèãÔ∏è
                    </a>
                    <a href="./tracker-info.html" role="menuitem" class="block w-min rounded-md px-3 p-1 text-zinc-300 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300 hover:bg-zinc-600 truncate">
                        Long Name That Keeps Going Past When It Should Probably Stop
                    </a>
                </div>
            </div>
        </div>

        <script>
            let nav_tracker_dropdown_open = false
            const nav_tracker_menu = document.getElementById("nav_tracker_menu")
            const nav_tracker_button = document.getElementById("nav_tracker_button")
            nav_tracker_button.addEventListener("click", event => {
                nav_tracker_menu.classList.toggle("hidden")
            })
            nav_tracker_menu.addEventListener("click", event => {
                if (event.target.id !== "nav_tracker_menu_items" && event.target.id !== "nav_tracker_menu_label") {
                    nav_tracker_menu.classList.toggle("hidden")
                }
            })
            nav_tracker_menu.addEventListener("focus", event => {
                if (event.target.id !== "nav_tracker_menu_items" && event.target.id !== "nav_tracker_menu_label") {
                    nav_tracker_menu.classList.toggle("hidden")
                }
            })
            document.addEventListener("keydown", event => {
                if (event.key === "Escape") {
                    nav_tracker_menu.classList.add("hidden")
                }
            })
        </script>
    </nav>

    <main>

        <!-- Create Tracker Form -->
        <section class="p-4 container max-w-xl w-full mx-auto flex flex-col gap-4">

            <form class="flex flex-col gap-4 sm:gap-8" hx-post="/htmx/tracker/create" zhx-target="#response">
    
                <div class="grid gap-1">
                    <label for="tracker_name" class="block py-1 grow">Name</label>
                    <input
                        type="text"
                        name="tracker_name" id="tracker_name"
                        value="Commissions" placeholder="Tracker Name" required
                        class="
                            px-3 py-2
                            bg-zinc-700 placeholder:text-zinc-500 
                            rounded-md border border-zinc-600
                            focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                        "
                    />
                </div>
    
                <div class="grid gap-1">
                    <label for="tracker_notes" class="block py-1 grow">Notes</label>
                    <textarea
                        id="tracker_notes" name="tracker_notes"
                        placeholder="Tracker Notes..."
                        class="
                            h-24 min-h-12
                            px-3 py-2
                            bg-zinc-700 placeholder:text-zinc-500
                            rounded-md border border-zinc-600
                            focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                        "
                    >Badger badger badger...</textarea>
                </div>
    
                <div class="grid gap-1">
                    <label for="data_fields" class="block py-1 grow">Fields</label>
                    <div id="data_fields" class="grid gap-8 mb-4">
    
                        <div class="grid gap-2">
                            <div class="flex gap-2 items-center">
    
                                <label for="field_type_1" class="sr-only"> Type </label>
                                <select
                                    id="field_type_1"
                                    name="field_type_1" 
                                    class="
                                        cursor-pointer
                                        px-3 py-1 h-10 w-28
                                        bg-zinc-700
                                        rounded-md border border-zinc-600
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                >
                                    <option value="number">Number</option>
                                    <option value="option">Option</option>
                                </select>
    
                                <label for="field_name_1" class="sr-only"> Name </label>
                                <input
                                    type="text"
                                    id="field_name_1"
                                    name="field_name_1"
                                    value="Cost" placeholder="Field Name"
                                    class="
                                        grow
                                        px-3 py-1 h-10
                                        bg-zinc-700
                                        rounded-md border border-zinc-600
                                        placeholder:text-zinc-500
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                                    "
                                >
                            </div>
    
                            <div class="flex gap-2 items-center">
                                <div title="Number.Decimal_Places: 2" class="w-8 h-10 grid place-items-center text-zinc-400">
                                    <label for="decimal_places_1" class="sr-only"> Decimal Places </label>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"/>
                                        <line x1="22" x2="18" y1="12" y2="12"/>
                                        <line x1="6" x2="2" y1="12" y2="12"/>
                                        <line x1="12" x2="12" y1="6" y2="2"/>
                                        <line x1="12" x2="12" y1="22" y2="18"/>
                                    </svg>
                                </div>
                                <input
                                    type="number"
                                    name="decimal_places_1"
                                    id="decimal_places_1"
                                    placeholder=0
                                    value=2
                                    class="h-10 grow min-w-16 px-3 py-1 bg-zinc-700 rounded-md border border-zinc-600 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                >
                            </div>
                        </div>
            
                        <div class="flex flex-col gap-2">
            
                            <div class="flex gap-2 items-center">
    
                                <label for="field_type_2" class="sr-only"> Type </label>
                                <select
                                    id="field_type_2"
                                    name="field_type_2" 
                                    class="
                                        cursor-pointer
                                        px-3 py-1
                                        h-10 w-28
                                        rounded-md border border-zinc-600 
                                        bg-zinc-700
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                                    "
                                >
                                    <option value="option">Option</option>
                                    <option value="number">Number</option>
                                </select>
    
                                <label for="field_name_2" class="sr-only"> Name </label>
                                <input
                                    type="text"
                                    id="field_name_2"
                                    name="field_name_2"
                                    value="Status"
                                    placeholder="Field Name"
                                    class="
                                        px-3 py-1
                                        h-10 grow
                                        bg-zinc-700 rounded-md border border-zinc-600
                                        placeholder:text-zinc-500
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                                    "
                                >
                            </div>
            
                            <div class="flex gap-2 items-center">
    
                                <label
                                    for="field_2_option_value_1"
                                    class="font-thin w-8 h-10 grid place-items-center text-zinc-400"
                                >#</label>
                                <input
                                    type="number"
                                    id="field_2_option_value_1"
                                    name="field_2_option_value_1"
                                    value=-1
                                    placeholder=1
                                    class="h-10 min-w-12 w-[4.5rem] px-3 rounded-md border border-zinc-600 bg-zinc-700 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                >
    
                                <label for="field_2_option_name_1" class="sr-only">
                                    Name
                                </label>
                                <input
                                    type="text"
                                    id="field_2_option_name_1"
                                    name="field_2_option_name_1"
                                    value="Canceled"
                                    placeholder="Option Name"
                                    class="h-10 grow px-3 bg-zinc-700 rounded-md border border-zinc-600 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                >
                            </div>
    
                            <div class="flex gap-2 items-center">
    
                                <div class="flex gap-2 items-center">
                                    <label
                                        for="field_2_option_value_2"
                                        class="font-thin w-8 h-10 grid place-items-center text-zinc-400"
                                    >#</label>
                                    <input
                                        type="number"
                                        id="field_2_option_value_2"
                                        name="field_2_option_value_2"
                                        value=0
                                        placeholder=1
                                        class="h-10 min-w-12 w-[4.5rem] px-3 rounded-md border border-zinc-600 bg-zinc-700 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                    >
                                </div>
    
                                <label for="field_2_option_name_2" class="sr-only">
                                    Name
                                </label>
                                <input
                                    type="text"
                                    id="field_2_option_name_2"
                                    name="field_2_option_name_2"
                                    value="Incomplete"
                                    placeholder="Option Name"
                                    class="
                                        h-10 w-full
                                        px-3 
                                        bg-zinc-700 rounded-md border border-zinc-600 
                                        placeholder:text-zinc-500 
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                                    "
                                >
                            </div>
            
                            <div class="flex gap-2 items-center">
    
                                <div class="flex gap-2 items-center">
                                    <label
                                        for="field_2_option_value_3"
                                        class="font-thin w-8 h-10 grid place-items-center text-zinc-400"
                                    >#</label>
                                    <input
                                        type="number"
                                        id="field_2_option_value_3"
                                        name="field_2_option_value_3"
                                        value=1
                                        placeholder=1
                                        class="h-10 min-w-12 w-[4.5rem] px-3 rounded-md border border-zinc-600 bg-zinc-700 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                    >
                                </div>
    
                                <label for="field_2_option_name_3" class="sr-only">
                                    Name
                                </label>
                                <input
                                    type="text"
                                    id="field_2_option_name_3"
                                    name="field_2_option_name_3"
                                    value="Complete"
                                    placeholder="Option Name"
                                    class="
                                        h-10 w-full
                                        px-3 
                                        bg-zinc-700 rounded-md border border-zinc-600 
                                        placeholder:text-zinc-500 
                                        focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                                    "
                                >
                            </div>
    
                            <div class="ml-10">
                                <button
                                    type="button"
                                    id="field_2_add_option"
                                    class="h-10 w-full p-1 text-zinc-400 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:text-zinc-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300"
                                >
                                    Add Option
                                </button>
                            </div>
    
                        </div>
        
                    </div>
                </div>
    
                <div class="flex gap-4">
                    <button
                        type="button"
                        id="add_field"
                        class="
                            h-10 w-full p-1
                            text-zinc-400
                            rounded-md border border-zinc-600
                            hover:bg-zinc-700 hover:text-zinc-200
                            focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300
                        "
                    >
                        Add Field
                    </button>
                    <input
                        type="submit"
                        value="Create"
                        class="
                            cursor-pointer
                            h-10 w-full p-1
                            bg-green-600 text-green-50
                            rounded-md border border-green-600
                            hover:bg-green-500 hover:text-green-50
                            focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-green-100
                        "
                    />
                </div>
            </form>
        </section>

    </main>
</body>

<script>
    let field_count = 0

    function create_field_row(id) {
        const field = document.createElement("div")
        field.setAttribute("class", "flex gap-2 items-center")
        
        const select_label = document.createElement("label")
        select_label.setAttribute("for", "field_type_" + id)
        select_label.setAttribute("class", "sr-only")
        select_label.innerText = "Type"
        field.appendChild(select_label)

        const select = document.createElement("select")
        select.setAttribute("id", "field_type_" + id)
        select.setAttribute("name", "field_type_" + id)
        select.setAttribute("class", "cursor-pointer px-3 py-1 h-10 w-28 rounded-md border border-zinc-600  bg-zinc-700 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        field.appendChild(select)

        const select_option_1 = document.createElement("option")
        select_option_1.value = "number"
        select_option_1.innerText = "Number"
        select.appendChild(select_option_1)

        const select_option_2 = document.createElement("option")
        select_option_2.value = "option"
        select_option_2.innerText = "Option"
        select.appendChild(select_option_2)

        const input_label = document.createElement("label")
        input_label.setAttribute("for", "field_name_" + id)
        input_label.setAttribute("class", "sr-only")
        input_label.innerText = "Name"
        field.appendChild(input_label)

        const input = document.createElement("input")
        input.setAttribute("type", "text")
        input.setAttribute("id", "field_name_" + id)
        input.setAttribute("name", "field_name_" + id)
        input.setAttribute("placeholder", "Field Name")
        input.setAttribute("class", "px-3 py-1 h-10 grow bg-zinc-700 rounded-md border border-zinc-600 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        field.appendChild(input)

        select.addEventListener("change", event => {

            // Remove option rows
            const parent = field.parentElement
            parent.childElementCount > 1
            while (parent.childElementCount > 1) {
                parent.removeChild(parent.lastElementChild);
            }

            // Add option rows
            const field_type = event.target.value
            if (field_type === "number") {
                const dec = create_number_decimal_row(id)
                parent.appendChild(dec)
            } else if (field_type === "option") {
                const option = create_option_row(id, 1)
                parent.appendChild(option)
                const add_option = create_add_option_button(id)
                parent.appendChild(add_option)
            }
        })

        return field
    }

    function create_number_decimal_row(id) {
        const row = document.createElement("div")
        row.setAttribute("class", "flex gap-2 items-center")

        const div = document.createElement("div")
        div.setAttribute("class", "w-8 h-10 grid place-items-center text-zinc-400")
        row.appendChild(div)

        const label = document.createElement("label")
        label.setAttribute("for", "decimal_places_" + id)
        label.setAttribute("class", "sr-only")
        label.innerText = "Decimal Places"
        div.appendChild(label)

        const svg = document.createElement("label")
        svg.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"/>
                <line x1="22" x2="18" y1="12" y2="12"/>
                <line x1="6" x2="2" y1="12" y2="12"/>
                <line x1="12" x2="12" y1="6" y2="2"/>
                <line x1="12" x2="12" y1="22" y2="18"/>
            </svg>`
        div.appendChild(svg)

        const input = document.createElement("input")
        input.setAttribute("type", "number")
        input.setAttribute("id", "decimal_places_" + id)
        input.setAttribute("name", "decimal_places_" + id)
        input.setAttribute("placeholder", 0)
        input.setAttribute("class", "h-10 grow min-w-16 px-3 py-1 bg-zinc-700 rounded-md border border-zinc-600 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        row.appendChild(input)

        return row
    }

    function create_option_row(id, option_id) {
        const row = document.createElement("div")
        row.setAttribute("class", "flex gap-2 items-center")

        const value_label = document.createElement("label")
        value_label.setAttribute("for", "field_" + id + "_option_value_" + option_id)
        value_label.setAttribute("class", "font-thin w-8 h-10 grid place-items-center text-zinc-400")
        value_label.innerText = "#"
        row.appendChild(value_label)

        const value = document.createElement("input")
        value.setAttribute("type", "number")
        value.setAttribute("id", "field_" + id + "_option_value_" + option_id)
        value.setAttribute("name", "field_" + id + "_option_value_" + option_id)
        value.setAttribute("placeholder", option_id)
        value.setAttribute("value", option_id)
        value.setAttribute("class", "h-10 min-w-16 w-[4.5rem] px-3 rounded-md border border-zinc-600 bg-zinc-700 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        row.appendChild(value)

        const name_label = document.createElement("label")
        name_label.setAttribute("for", "field_" + id + "_option_name_" + option_id)
        name_label.setAttribute("class", "sr-only")
        name_label.innerText = "Name"
        row.appendChild(name_label)

        const name = document.createElement("input")
        name.setAttribute("type", "text")
        name.setAttribute("id", "field_" + id + "_option_name_" + option_id)
        name.setAttribute("name", "field_" + id + "_option_name_" + option_id)
        name.setAttribute("placeholder", "Option Name")
        name.setAttribute("class", "h-10 grow px-3 bg-zinc-700 rounded-md border border-zinc-600 placeholder:text-zinc-500 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        row.appendChild(name)

        return row
    }

    function create_add_option_button(field_count) {
        let option_counter = 1

        const row = document.createElement("div")
        row.setAttribute("class", "ml-10")

        const button = document.createElement("button")
        button.setAttribute("id", "field_2_add_option")
        button.setAttribute("type", "button")
        button.setAttribute("class", "h-10 w-full p-1 text-zinc-400 rounded-md border border-zinc-600 hover:bg-zinc-700 hover:text-zinc-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-zinc-300")
        button.innerText = "Add Option"
        row.appendChild(button)

        button.addEventListener("click", event => {
            option_counter++

            const option = create_option_row(field_count, option_counter)
            row.insertAdjacentElement("beforebegin", option);
        })

        return row
    }

    document.getElementById("add_field").addEventListener("click", event => {
        field_count++

        const parent = document.createElement("div")
        parent.setAttribute("class", "flex flex-col gap-2")

        const field = create_field_row(field_count)
        parent.appendChild(field)

        const dec = create_number_decimal_row(field_count)
        parent.appendChild(dec)

        document.getElementById("data_fields").appendChild(parent)
    })

</script>

</html>